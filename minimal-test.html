<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimal Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-btn { background: blue; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 10px; }
        .test-btn:hover { background: darkblue; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>Minimal Plan Creation Test</h1>
    
    <div>
        <button class="test-btn" onclick="testDirectImport()">Test Direct Import</button>
        <button class="test-btn" onclick="testComponentCreation()">Test Component Creation</button>
        <button class="test-btn" onclick="testButtonClick()">Test Button Click</button>
        <button class="test-btn" onclick="testNavigation()">Test Navigation</button>
    </div>
    
    <div id="results"></div>
    
    <!-- Hidden views for testing -->
    <div id="plan-list-view" style="display: none; border: 1px solid #ccc; padding: 20px; margin: 20px 0;">
        <h2>Plan List View</h2>
        <button class="test-btn" onclick="simulateCreatePlanClick()">Create New Plan</button>
    </div>
    
    <div id="plan-editor-view" style="display: none; border: 1px solid green; padding: 20px; margin: 20px 0;">
        <h2>Plan Editor View</h2>
        <p>Plan editor should appear here</p>
    </div>

    <script type="module">
        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.textContent = message;
            results.appendChild(div);
            console.log(message);
        }

        window.testDirectImport = async function() {
            try {
                addResult('Testing direct import...', 'info');
                
                // Import components
                const { PlanList } = await import('./frontend/js/components/PlanList.js');
                const { PlanEditor } = await import('./frontend/js/components/PlanEditor.js');
                const { TrainingPlan } = await import('./frontend/js/models/TrainingPlan.js');
                
                addResult('✅ Components imported successfully', 'success');
                
                // Make available globally
                window.PlanList = PlanList;
                window.PlanEditor = PlanEditor;
                window.TrainingPlan = TrainingPlan;
                
            } catch (error) {
                addResult(`❌ Import failed: ${error.message}`, 'error');
                console.error('Import error:', error);
            }
        };

        window.testComponentCreation = function() {
            try {
                addResult('Testing component creation...', 'info');
                
                if (!window.PlanList) {
                    addResult('❌ PlanList not available', 'error');
                    return;
                }
                
                if (!window.PlanEditor) {
                    addResult('❌ PlanEditor not available', 'error');
                    return;
                }
                
                // Create mock services
                const mockApiService = {
                    getTrainingPlans: async () => [],
                    createTrainingPlan: async (data) => ({ ...data, id: 'test-plan' })
                };
                
                const mockNavigationService = {
                    navigateTo: (view, params) => {
                        addResult(`🎯 Navigation called: ${view} with params: ${JSON.stringify(params)}`, 'info');
                        
                        // Simulate view switching
                        if (view === 'plan-editor') {
                            document.getElementById('plan-list-view').style.display = 'none';
                            document.getElementById('plan-editor-view').style.display = 'block';
                        }
                    }
                };
                
                // Create PlanList component
                const planListContainer = document.getElementById('plan-list-view');
                const planList = new PlanList(planListContainer, mockApiService, mockNavigationService);
                
                addResult('✅ PlanList component created successfully', 'success');
                
                // Store for later use
                window.testPlanList = planList;
                
            } catch (error) {
                addResult(`❌ Component creation failed: ${error.message}`, 'error');
                console.error('Component creation error:', error);
            }
        };

        window.testButtonClick = function() {
            try {
                addResult('Testing button click...', 'info');
                
                if (!window.testPlanList) {
                    addResult('❌ PlanList not created yet', 'error');
                    return;
                }
                
                // Show the plan list view
                document.getElementById('plan-list-view').style.display = 'block';
                document.getElementById('plan-editor-view').style.display = 'none';
                
                // Find and click the create button
                const createButton = document.querySelector('#plan-list-view .test-btn');
                if (createButton) {
                    addResult('✅ Create button found, clicking...', 'info');
                    createButton.click();
                } else {
                    addResult('❌ Create button not found', 'error');
                }
                
            } catch (error) {
                addResult(`❌ Button click test failed: ${error.message}`, 'error');
            }
        };

        window.simulateCreatePlanClick = function() {
            try {
                addResult('🎯 Simulating Create Plan button click...', 'info');
                
                if (!window.testPlanList) {
                    addResult('❌ PlanList not available', 'error');
                    return;
                }
                
                // Call the handleCreatePlan method directly
                window.testPlanList.handleCreatePlan();
                
            } catch (error) {
                addResult(`❌ Create plan click failed: ${error.message}`, 'error');
                console.error('Create plan error:', error);
            }
        };

        window.testNavigation = function() {
            try {
                addResult('Testing navigation...', 'info');
                
                // Create PlanEditor component
                const planEditorContainer = document.getElementById('plan-editor-view');
                const mockApiService = { createTrainingPlan: async (data) => data };
                const mockNavigationService = {
                    navigateTo: (view) => {
                        addResult(`🎯 Navigation to: ${view}`, 'info');
                    }
                };
                
                if (window.PlanEditor) {
                    const planEditor = new PlanEditor(planEditorContainer, mockApiService, mockNavigationService);
                    planEditor.init();
                    addResult('✅ PlanEditor created and initialized', 'success');
                    
                    // Show the editor
                    document.getElementById('plan-list-view').style.display = 'none';
                    document.getElementById('plan-editor-view').style.display = 'block';
                    
                } else {
                    addResult('❌ PlanEditor not available', 'error');
                }
                
            } catch (error) {
                addResult(`❌ Navigation test failed: ${error.message}`, 'error');
                console.error('Navigation test error:', error);
            }
        };

        // Auto-start with direct import test
        window.addEventListener('load', () => {
            addResult('Page loaded, starting tests...', 'info');
        });
    </script>
</body>
</html>
