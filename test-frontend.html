<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GRND Frontend Tests</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .test-output {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>GRND Frontend Tests</h1>
    
    <div class="test-section">
        <h2>1. API Service Tests</h2>
        <button onclick="testApiService()">Test API Service</button>
        <div id="api-results"></div>
    </div>

    <div class="test-section">
        <h2>2. Data Models Tests</h2>
        <button onclick="testDataModels()">Test Data Models</button>
        <div id="models-results"></div>
    </div>

    <div class="test-section">
        <h2>3. Volume Calculation Tests</h2>
        <button onclick="testVolumeCalculation()">Test Volume Calculation</button>
        <div id="volume-results"></div>
    </div>

    <div class="test-section">
        <h2>4. Navigation Service Tests</h2>
        <button onclick="testNavigationService()">Test Navigation Service</button>
        <div id="navigation-results"></div>
    </div>

    <div class="test-section">
        <h2>5. Storage Service Tests</h2>
        <button onclick="testStorageService()">Test Storage Service</button>
        <div id="storage-results"></div>
    </div>

    <div class="test-section">
        <h2>6. Image Service Tests</h2>
        <button onclick="testImageService()">Test Image Service</button>
        <div id="image-results"></div>
    </div>

    <script type="module">
        // Import all the modules we need to test
        import { ApiService } from './frontend/js/services/ApiService.js';
        import { NavigationService } from './frontend/js/services/NavigationService.js';
        import { StorageService } from './frontend/js/services/StorageService.js';
        import { ImageService } from './frontend/js/services/ImageService.js';
        import { TrainingPlan } from './frontend/js/models/TrainingPlan.js';
        import { Week } from './frontend/js/models/Week.js';
        import { Day } from './frontend/js/models/Day.js';
        import { Exercise } from './frontend/js/models/Exercise.js';
        import { WorkoutSession } from './frontend/js/models/WorkoutSession.js';
        import { UserProfile } from './frontend/js/models/UserProfile.js';
        import { VolumeCalculator } from './frontend/js/utils/VolumeCalculator.js';

        // Make services available globally for testing
        window.apiService = new ApiService();
        window.navigationService = new NavigationService();
        window.storageService = new StorageService();
        window.imageService = new ImageService();

        // Make models available globally
        window.TrainingPlan = TrainingPlan;
        window.Week = Week;
        window.Day = Day;
        window.Exercise = Exercise;
        window.WorkoutSession = WorkoutSession;
        window.UserProfile = UserProfile;
        window.VolumeCalculator = VolumeCalculator;

        // Test functions
        window.testApiService = async function() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.innerHTML = '<div class="info">Testing API Service...</div>';
            
            try {
                // Test workout data endpoint
                const workoutData = await window.apiService.getWorkoutData('test-user');
                resultsDiv.innerHTML += `<div class="success">✅ GET workout data: ${workoutData.plan_name}</div>`;
                
                // Test user profile endpoint
                const userProfile = await window.apiService.getUserProfile('test-user');
                resultsDiv.innerHTML += `<div class="success">✅ GET user profile: ${userProfile.bodyweight}kg</div>`;
                
                // Test volume calculation
                const volumeResult = await window.apiService.calculateVolume(70, [
                    {
                        exercise_name: "Push-ups",
                        exercise_type: "BODYWEIGHT",
                        completed_sets: [{ reps: 10 }]
                    }
                ]);
                resultsDiv.innerHTML += `<div class="success">✅ Volume calculation: ${volumeResult.total_volume_kg}kg</div>`;
                
            } catch (error) {
                resultsDiv.innerHTML += `<div class="error">❌ API Service Error: ${error.message}</div>`;
            }
        };

        window.testDataModels = function() {
            const resultsDiv = document.getElementById('models-results');
            resultsDiv.innerHTML = '<div class="info">Testing Data Models...</div>';
            
            try {
                // Test TrainingPlan model
                const plan = new TrainingPlan({
                    plan_id: 'test-plan',
                    plan_name: 'Test Plan',
                    start_date: '2025-07-30T00:00:00.000Z'
                });
                resultsDiv.innerHTML += `<div class="success">✅ TrainingPlan: ${plan.plan_name}</div>`;
                
                // Test Exercise model
                const exercise = new Exercise({
                    exercise_id: 'test-ex',
                    exercise_name: 'Push-ups',
                    exercise_type: 'BODYWEIGHT',
                    target_sets: 3,
                    target_reps: 10
                });
                resultsDiv.innerHTML += `<div class="success">✅ Exercise: ${exercise.displaySetsReps}</div>`;
                
                // Test UserProfile model
                const profile = new UserProfile({
                    userId: 'test-user',
                    bodyweight: 70
                });
                profile.validate();
                resultsDiv.innerHTML += `<div class="success">✅ UserProfile: ${profile.bodyweight}kg</div>`;
                
            } catch (error) {
                resultsDiv.innerHTML += `<div class="error">❌ Data Models Error: ${error.message}</div>`;
            }
        };

        window.testVolumeCalculation = function() {
            const resultsDiv = document.getElementById('volume-results');
            resultsDiv.innerHTML = '<div class="info">Testing Volume Calculation...</div>';
            
            try {
                // Test bodyweight exercise volume calculation
                const bodyweightExercise = {
                    exercise_name: 'Push-ups',
                    exercise_type: 'BODYWEIGHT',
                    completed_sets: [
                        { reps: 10 },
                        { reps: 8 },
                        { reps: 6 }
                    ]
                };
                
                const bodyweightVolume = VolumeCalculator.calculateExerciseVolume(bodyweightExercise, 70, 0.75);
                resultsDiv.innerHTML += `<div class="success">✅ Bodyweight Volume: ${bodyweightVolume}kg (70kg × 0.75 × 24 reps)</div>`;
                
                // Test weighted exercise volume calculation
                const weightedExercise = {
                    exercise_name: 'Bench Press',
                    exercise_type: 'WEIGHTED',
                    completed_sets: [
                        { reps: 8, weight: 60 },
                        { reps: 6, weight: 65 },
                        { reps: 4, weight: 70 }
                    ]
                };
                
                const weightedVolume = VolumeCalculator.calculateExerciseVolume(weightedExercise, 70, 1.0);
                resultsDiv.innerHTML += `<div class="success">✅ Weighted Volume: ${weightedVolume}kg (60×8 + 65×6 + 70×4)</div>`;
                
                // Test total volume calculation
                const totalVolume = VolumeCalculator.calculateTotalVolume([bodyweightExercise, weightedExercise], 70);
                resultsDiv.innerHTML += `<div class="success">✅ Total Volume: ${totalVolume}kg</div>`;
                
            } catch (error) {
                resultsDiv.innerHTML += `<div class="error">❌ Volume Calculation Error: ${error.message}</div>`;
            }
        };

        window.testNavigationService = function() {
            const resultsDiv = document.getElementById('navigation-results');
            resultsDiv.innerHTML = '<div class="info">Testing Navigation Service...</div>';
            
            try {
                // Test navigation methods
                resultsDiv.innerHTML += `<div class="success">✅ Current view: ${window.navigationService.getCurrentView()}</div>`;
                resultsDiv.innerHTML += `<div class="success">✅ Can go back: ${window.navigationService.canGoBack()}</div>`;
                
                // Test utility navigation methods
                window.navigationService.navigateToPlanList();
                resultsDiv.innerHTML += `<div class="success">✅ Navigate to plan list</div>`;
                
                window.navigationService.navigateToSettings();
                resultsDiv.innerHTML += `<div class="success">✅ Navigate to settings</div>`;
                
            } catch (error) {
                resultsDiv.innerHTML += `<div class="error">❌ Navigation Service Error: ${error.message}</div>`;
            }
        };

        window.testStorageService = async function() {
            const resultsDiv = document.getElementById('storage-results');
            resultsDiv.innerHTML = '<div class="info">Testing Storage Service...</div>';
            
            try {
                // Test basic storage operations
                await window.storageService.setItem('test-key', 'test-value');
                const value = await window.storageService.getItem('test-key');
                resultsDiv.innerHTML += `<div class="success">✅ Basic storage: ${value}</div>`;
                
                // Test user bodyweight storage
                await window.storageService.setUserBodyweight(75);
                const bodyweight = await window.storageService.getUserBodyweight();
                resultsDiv.innerHTML += `<div class="success">✅ Bodyweight storage: ${bodyweight}kg</div>`;
                
                // Test user profile storage
                const profile = { userId: 'test-user', bodyweight: 80 };
                await window.storageService.setUserProfile(profile);
                const storedProfile = await window.storageService.getUserProfile();
                resultsDiv.innerHTML += `<div class="success">✅ Profile storage: ${storedProfile.bodyweight}kg</div>`;
                
            } catch (error) {
                resultsDiv.innerHTML += `<div class="error">❌ Storage Service Error: ${error.message}</div>`;
            }
        };

        window.testImageService = async function() {
            const resultsDiv = document.getElementById('image-results');
            resultsDiv.innerHTML = '<div class="info">Testing Image Service...</div>';
            
            try {
                // Test fallback images (since we might not have Unsplash API key)
                const fallbackImages = window.imageService.getFallbackImages('push-ups');
                resultsDiv.innerHTML += `<div class="success">✅ Fallback images: ${fallbackImages.length} images</div>`;
                
                // Test image search (this might fail without API key, which is expected)
                try {
                    const searchResults = await window.imageService.searchExerciseImages('fitness', 1);
                    resultsDiv.innerHTML += `<div class="success">✅ Image search: ${searchResults.length} results</div>`;
                } catch (searchError) {
                    resultsDiv.innerHTML += `<div class="info">ℹ️ Image search failed (expected without API key): ${searchError.message}</div>`;
                }
                
            } catch (error) {
                resultsDiv.innerHTML += `<div class="error">❌ Image Service Error: ${error.message}</div>`;
            }
        };

        // Auto-run basic tests on page load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('GRND Frontend Test Suite Loaded');
        });
    </script>
</body>
</html>
